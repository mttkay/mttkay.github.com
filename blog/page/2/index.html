
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>mttkay here.</title>
	<meta name="author" content="Matthias KÃ¤ppler">

	
	<meta name="description" content="Today it&#8217;s &#8220;Fun Friday&#8221; (10% time)&nbsp;at Qype, so we thought this would be a good opportunity to release the first version of &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="mttkay here." type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">mttkay here.</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:mttkay.github.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		<a class="google" href="https://plus.google.com/112265135089213955243?rel=author" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/mttkay" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/mttkay" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:mttkay.github.com">
	</form>
</nav>

</header>
	
		
<div id="banner" class="inner">
	<div class="container">
		<ul class="feed"></ul>
	</div>
	<small><a href="http://twitter.com/mttkay">mttkay</a> @ <a href="http://twitter.com">Twitter</a></small>
	<div class="loading">Loading...</div>
</div>
<script src="/javascripts/twitter.js"></script>
<script type="text/javascript">
	(function($){
		$('#banner').getTwitterFeed('mttkay', 4, false);
	})(jQuery);
</script>

	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/03/09/ignition-0-1-is-here/">
		
			Ignition 0.1 Is Here</a>
	</h2>
	<div class="entry-content">
		<p>Today it&#8217;s &#8220;Fun Friday&#8221; (10% time)&nbsp;at Qype, so we thought this would be a good opportunity to release the first version of our <a href="https://github.com/mttkay/ignition">ignition</a> library for Android!</p>
<p>What&#8217;s ignition? In short, it&#8217;s a rewrite of <a href="https://github.com/mttkay/droid-fu">Droid-Fu</a>. What is Droid-Fu? It was an attempt to create a utility library for Android that makes your life easier by creating add-ons and wrappers for the Android framework classes that are just a little friendler to use. Our approach with Droid-Fu was to pull all the helper code and boilerplate we wrote for our Qype app into a reusable library, but we did a poor job at maintaining it. We didn&#8217;t have proper release and issue management in place and since I was short of spare time (not least due to my work on <a href="http://brainflush.wordpress.com/2011/10/31/our-android-book-android-in-practice-is-here/">Android in Practice</a>), it just never happened. We soon&nbsp;had many issues filed, but it was virtually impossible for us to backtrack through all the snapshot versions to find out which one it was actually affecting.</p>
<p>Moreover, we did mistakes with Droid-Fu&#8217;s API design, and we wanted to have a chance of fixing these without horribly breaking all the apps that used it. Yes, we could have done a &#8220;Droid-Fu 2.0&#8221; (even though there never even was a 1.0) or a &#8220;Droid-Fu NG&#8221;, but I felt the least intrusive way would be to start out fresh as morning dew.</p>
<p>The fruit of this labor is ignition, and I believe we improved things a lot. First, here&#8217;s what ignition has to offer in the first place:</p>
<p><span style="font-size: large;">Cross-cutting stuff</span></p>
<ul>
<li>helper classes for dealing with Intents, dialogs, device screens, etc.</li>
<li>an improved version of AsyncTask (<a href="http://mttkay.github.com/ignition-docs/ignition-core/apidocs/com/github/ignition/core/tasks/IgnitedAsyncTask.html">IgnitedAsyncTask</a>) which makes it a lot easier to deal with the following things:    
<ul>
<li>task life-cycle: there are onStart, onComplete, onSuccess, and onError callbacks</li>
<li>yes, your task may now raise exceptions while running</li>
<li>all callbacks are guaranteed to be passed a valid Context object, so that you can immediately update the UI (those must be bound and unbound using connect/disconnect to avoid memory leaks!)</li>
<li>re-use task logic from pre- and post-execute handlers by being able to bind to different callables that execute the actual job logic</li>
</ul>
</li>
<li><a href="http://mttkay.github.com/ignition-docs/ignition-core/apidocs/com/github/ignition/core/adapters/EndlessListAdapter.html">EndlessListAdapter</a> can be used to implement lists that fetch more content when reaching the bottom of the list</li>
</ul>
<p><span style="font-size: large;">Dealing with remote images</span></p>
<ul>
<li><a href="http://mttkay.github.com/ignition-docs/ignition-core/apidocs/com/github/ignition/core/widgets/RemoteImageView.html">RemoteImageView</a> is a drop-in replacement for ImageView which can download its image resource from the Web and show a progress spinner in the mean time</li>
<li>if you&#8217;re showing a whole bunch of these, you can use <a href="http://mttkay.github.com/ignition-docs/ignition-core/apidocs/com/github/ignition/core/adapters/RemoteImageGalleryAdapter.html">RemoteImageGalleryAdapter</a> which will feed RemoteImageViews into an Android gallery widget</li>
<li>both are backed by <a href="http://mttkay.github.com/ignition-docs/ignition-support/apidocs/com/github/ignition/support/images/remote/RemoteImageLoader.html">RemoteImageLoader</a>, which can be used independently to download images drawable into ImageViews asynchronously. We use this to download thumbnail images for list elements in ListViews on the fly.</li>
<li>all this in turn is backed by <a href="http://mttkay.github.com/ignition-docs/ignition-support/apidocs/com/github/ignition/support/cache/ImageCache.html">ImageCache</a>, a 2-level cache which is able to cache to both internal storage and SD card, therefore minimizing network traffic when dealing with lots of data (as is the case with images)</li>
</ul>
<p><span style="font-size: large;">Dealing with HTTP requests and network failures</span></p>
<ul>
<li>speaking of caching, you can not only cache image data, but also HTTP responses using <a href="http://mttkay.github.com/ignition-docs/ignition-support/apidocs/com/github/ignition/support/http/cache/HttpResponseCache.html">HttpResponseCache</a></li>
<li>better yet, <a href="http://mttkay.github.com/ignition-docs/ignition-support/apidocs/com/github/ignition/support/http/IgnitedHttp.html">IgnitedHttp</a> is an abstraction of Android&#8217;s Apache HttpClient that exposes a simple DSL to build and send HTTP requests, like so:    
<ul>
<li>new IgnitedHttp().get(&#8220;http://example.com&#8221;).expecting(200, 404).retries(3).withTimeout(5000).send();</li>
</ul>
</li>
<li>it integrates with the response cache by setting a single flag</li>
<li>it will enable GZip uncompression of response data with a single flag</li>
<li>it will register a BroadcastReceiver which listens for changes in network configuration and automatically update e.g. proxy settings for you (this can be a major source of error in your app for users who must go through carrier proxies on 3G and then fail over from or to Wi-Fi)</li>
<li>it has a more robust request-retry logic than the standard HttpClient does</li>
</ul>
<p><span style="font-size: large;">Dealing with location</span></p>
<p>Stefano has build a fantastic new way of dealing with location on Android. It takes all the cruft out of your Activities and hides it in a single annotation you drop onto an Activity. It will then automagically inject location fixes into a prepared field, using the power of AspectJ. <a href="http://mod3rn-android-coding.posterous.com/ignition-v01-ignited-way-of-doing-location">Read more about it on his blog</a>.</p>
<p><span style="font-size: large;">What&#8217;s different to Droid-Fu?</span></p>
<p>Except for the location module, all of this has existed in Droid-Fu. As I mentioned before, the motivation behind iginition was not to build a new library, but re-launch what worked well for us in a more maintainable and less intrusive way. Here&#8217;s what changed:</p>
<ul>
<li>The project is now split into multiple modules, so you can decide which ones you&#8217;d like to link. This makes the whole thing less monolithic, and for instance doesn&#8217;t force the Maps dependency on you if you do not want to use the location stuff</li>
<li>The project is less intrusive. You do not have to inherit from BetterApplication, BetterActivity or BetterService anymore (these classes have been removed). This was done as to make ignition integrate seamlessly with other libraries like <a href="http://code.google.com/p/roboguice/">Roboguice</a>. We felt that ignition was not supposed to be a framework: it should be an all-opt-in solution.</li>
<li>The API has received a major cleanup. Things have been renamed, restructured, and generally made more consistent.</li>
</ul>
<p>Where can I get more information?</p>
<p>It&#8217;s <a href="https://github.com/mttkay/ignition">all on GitHub</a> right now, but here are some quick links to useful stuff:</p>
<ul>
<li><a href="https://github.com/mttkay/ignition/wiki/Installation-and-setup">installation / usage guide</a></li>
<li><a href="https://github.com/mttkay/ignition/wiki/Sample-applications">sample projects</a></li>
</ul>
<p>Thanks again for everyone who contributed issue report and fixes! We promise we&#8217;ll do more regular updates with this library.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-03-09T00:00:00+01:00" pubdate data-updated="true">Mar 9<span>th</span>, 2012</time></div>
	<div class="tags">

</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/03/03/getting-to-grips-with-the-android-4-0-3-social-apis/">
		
			Getting to Grips With the Android 4.0.3 Social APIs</a>
	</h2>
	<div class="entry-content">
		<ul>
</ul>
<p>This post also appears on&nbsp;<a href="http://engineering.qype.com/" target="_blank">engineering.qype.com</a>.</p>
<p>We recently started getting our hands onto some of the shiny new Ice Cream Sandwich APIs, particularly Beam and the <a href="http://android-developers.blogspot.com/2012/02/new-social-apis-in-android-ics.html">social stream API</a> that was introduced with Android 4.0.3. Integration turned out to be a little harder than we expected, mostly due to two things: code verbosity (you&#8217;ll write a lot of boilerplate) and undocumented pitfalls. With this post I&#8217;d like to shed some light on a few things that bit us when developing with the new APIs.</p>
<p><span style="font-size: x-large;">Integrating with the social stream</span></p>
<p>First of all, you should know that to get going with the social stream, you will have to go through two major steps:</p>
<ol>
<li>Publish your app as an account provider, and log in your users via the <a href="http://developer.android.com/reference/android/accounts/AccountManager.html">AccountManager</a> API, so that contacts from your service can be synced with the Android address book (now called the People app in ICS)</li>
<li>Once your contacts are synced with the People app, import their status updates into the &#8220;Recent Updates&#8221; feed</li>
</ol>
<p>I won&#8217;t talk&nbsp;about 1. There are two excellent blog posts on how to deal with <a href="http://www.c99.org/2010/01/23/writing-an-android-sync-provider-part-1/">connecting accounts</a> and <a href="http://www.c99.org/2010/01/23/writing-an-android-sync-provider-part-2/">syncing contacts</a> respectively, plus the SampleSyncAdapter app that is shipped with the SDK ApiDemos. Once you&#8217;re there, adding support for publishing a user&#8217;s social feed is generally quite simple. From here on I assume that you have read all the documentation that is available, since I want to focus on the difficult parts. Let&#8217;s have a look at the final product first.</p>
<p>[[posterous-content:yFlmybGeCDDFFbADcDyf]]</p>
<p>Let&#8217;s quickly recap when the &#8220;Recent Updates&#8221; pane appears. It becomes available whenever there are status updates from the contact you&#8217;re looking at that are no older than a few days (I believe it&#8217;s five days, but I haven&#8217;t exactly checked that). There is also a threshold for how many items will ever show up at the same time, and as pointed out in the docs, this threshold is platform or even device specific.</p>
<p>There are two ways to import these status updates from your service: <em>eagerly</em>, as part of the contacts sync (i.e. in your contacts SyncAdapter), or <em>lazily</em>, via an Intent that is fired whenever a user looks at another user&#8217;s profile. Again, the general mechanics behind this are outlined on the <a href="http://android-developers.blogspot.com/2012/02/new-social-apis-in-android-ics.html">Android dev blog</a>.</p>
<p>Generally, you don&#8217;t want to fetch status updates (plus images) for a hundred or more contacts as part of the sync, since it&#8217;s very unlikely that a user would look at all of them to see their status updates. I say &#8220;plus images&#8221;, because you will have to download them synchronously and either insert them in binary form into the <a href="http://developer.android.com/reference/android/provider/ContactsContract.StreamItemPhotos.html">StreamItemPhotos</a> table, or write them to disk using an <a href="http://developer.android.com/reference/android/content/res/AssetFileDescriptor.html">AssetFileDescriptor</a>. Since ICS devices often have high resolution displays, you want to download high res images, so that&#8217;s a lot of data you&#8217;re pushing over the wire, keep that in mind.</p>
<p>Hence, you most likely want to go down the callback route, perhaps with optionally pre-populating important contacts with their status updates during contacts sync (what important means depends on your service, but you could for instance check if the user has starred a contact, and prefetch status updates accordingly).</p>
<p>Regardless for which sync strategy you settle (lazy or pre-fetched or hybrid), here are a few things that bit me while syncing social stream items.
		
		<a href="/blog/2012/03/03/getting-to-grips-with-the-android-4-0-3-social-apis/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-03-03T00:00:00+01:00" pubdate data-updated="true">Mar 3<span>rd</span>, 2012</time></div>
	<div class="tags">

</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/01/27/the-signpost-oauth-project-has-an-owner-again-/">
		
			The Signpost OAuth Project Has an Owner Again!</a>
	</h2>
	<div class="entry-content">
		<p>In 2009, I <a href="http://brainflush.wordpress.com/2009/05/03/introducing-signpost-easy-oauth-for-java-and-apache-httpcomponents-android-too/">introduced Signpost</a>, a lightweight, client-side OAuth library for Java. I initially created it to power the API connector in our <a href="https://market.android.com/details?id=com.qype.radar">Qype Android app</a>, and kept maintaining it for a year or two, until I <a href="http://brainflush.wordpress.com/2011/01/27/stepping-back-from-signpost-development/">got bored with fixing random issues</a> with random OAuth service providers that I honestly didn&#8217;t care about whatsoever. In its latest release, the library still works flawlessly for us, so I had little motivation to continue work on it.</p>
<p>However, I understand that it probably doesn&#8217;t work flawlessly for everyone, so with me backing away from developing it further, a project maintainer was obviously needed. It looks like we&#8217;ve finally found someone who&#8217;s willing to enter the painful world of OAuth 1.0! Meet <a href="http://blog.polysfactory.com/">Takahiro Horikawa</a>, who will take full ownership of the project from here on, managing issues, releases, and the project website.</p>
<p>If you&#8217;re interested in helping out, give us a shout on <a href="https://groups.google.com/forum/?hl=en#!forum/signpost-dev">signpost-developers</a>!</p>
<p><a href="http://code.google.com/p/oauth-signpost/">Signpost project page</a></p>
<p><a href="https://twitter.com/#!/thorikawa">Takahiro&#8217;s Twitter</a></p>
<p><a href="https://github.com/thorikawa">Takahiro&#8217;s GitHub</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-01-27T00:00:00+01:00" pubdate data-updated="true">Jan 27<span>th</span>, 2012</time></div>
	<div class="tags">

</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/01/21/robolectric-setting-android-home-for-all-tests-macos-eclipse-/">
		
			Robolectric: Setting ANDROID_HOME for All Tests (MacOS/Eclipse)</a>
	</h2>
	<div class="entry-content">
		<p>I just stumbled over the somewhat annoying issue that when running <a href="http://pivotal.github.com/robolectric/">Robolectric</a> tests in Eclipse, the library must see the ANDROID_HOME environment variable, or resource lookups in the android namespace will fail (you&#8217;ll see a warning about this on the console).</p>
<p>Now, you can of course fix that by adding ANDROID_HOME to every single Eclipse Run configuration for your tests, but that would be cumbersome. It would be better to have this variable set for Eclipse so that all Java processes forked from it will inherit it, including your test runs. Unfortunately MacOS X doesn&#8217;t seem to have a straight forward solution to that. I tried modifying Eclipse&#8217;s plist file, to define <a href="http://developer.apple.com/library/mac/#documentation/General/Reference/InfoPlistKeyReference/Articles/LaunchServicesKeys.html#//apple_ref/doc/uid/TP40009250-SW1">LSEnvironment</a>, but that did not have any effect.</p>
<p>However, what you can do is have all MacOS processes inherit it by <a href="http://www.digitaledgesw.com/node/31">setting it in /etc/launchd.conf</a>. This is somewhat quick and dirty, since you only really need it in Eclipse and Terminal, but it does the job:</p>
<div class="CodeRay">
  <div class="code"><pre>$sudo vim /etc/launchd.conf</pre></div>
</div>

<p>Now add this line:</p>
<div class="CodeRay">
  <div class="code"><pre>setenv ANDROID_HOME /path/to/android-sdk</pre></div>
</div>

<p>Reboot, and rejoice.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-01-21T00:00:00+01:00" pubdate data-updated="true">Jan 21<span>st</span>, 2012</time></div>
	<div class="tags">

</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/01/11/which-screen-am-i-no-more-getting-lost-in-android-screen-configurations/">
		
			Which Screen Am I? No More Getting Lost in Android Screen Configurations</a>
	</h2>
	<div class="entry-content">
		<p>Are you as puzzled as me when it comes to Android screen classification? According to the official docs, Android puts device screens into buckets, based on two properties: screen size, and pixel density. However, the lines are blurry, it&#8217;s often not clear which exact values are used to put a device in one bucket or the next.</p>
<p>If you keep pondering the screen class of your device(s), ponder no more. I&#8217;ve built a little app that helps developers decide in which of these buckets your device falls. It&#8217;s called <a href="https://market.android.com/details?id=com.github.kaeppler.whichscreen">Which Screen Am I?</a> and it&#8217;s <a href="https://github.com/kaeppler/WhichScreenAmI">free and open source</a>. This is how it looks on a FroYo emulator that uses the HVGA skin and a medium pixel density:</p>
<p>[[posterous-content:zvpucdcdirfbBIjfDeHk]]</p>
<p>If you&#8217;re targeting different screen configurations with different APKs, this takes at least some of the pain out of the testing process.</p>
<p>GitHub:&nbsp;<a href="https://github.com/kaeppler/WhichScreenAmI">https://github.com/kaeppler/WhichScreenAmI</a></p>
<p>Android Market (Web):&nbsp;<a href="https://market.android.com/details?id=com.github.kaeppler.whichscreen">https://market.android.com/details?id=com.github.kaeppler.whichscreen</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-01-11T00:00:00+01:00" pubdate data-updated="true">Jan 11<span>th</span>, 2012</time></div>
	<div class="tags">

</div>
	
</div>
</article>

<nav id="pagenavi">
    
        <a href="/" class="prev">Prev</a>
    
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2014

    Matthias KÃ¤ppler

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->




	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-38754031-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>